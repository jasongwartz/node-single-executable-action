# GitHub Action: Node Single Executable

[![GitHub Super-Linter](https://github.com/jasongwartz/node-single-executable-action/actions/workflows/linter.yml/badge.svg)](https://github.com/super-linter/super-linter)
![CI](https://github.com/jasongwartz/node-single-executable-action/actions/workflows/ci.yml/badge.svg)
[![Check dist/](https://github.com/jasongwartz/node-single-executable-action/actions/workflows/check-dist.yml/badge.svg)](https://github.com/actions/typescript-action/actions/workflows/check-dist.yml)
[![Coverage](./badges/coverage.svg)](./badges/coverage.svg)

This GitHub Action can be used to create
[single executable applications in Node.js](https://nodejs.org/api/single-executable-applications.html),
where a "single executable application" (or SEA) is a packaging mechanism that
embeds some JavaScript source code together with the Node.js runtime. The
resulting executable can be distributed and run on machines that do not
otherwise have an installation Node.js, or which would have an incompatible
version. This can be particularly useful in creating portable command-line tools
or self-contained scripts.

See also:

- [Node SEA documentation](https://nodejs.org/api/single-executable-applications.html)
- [Node SEA team on GitHub](https://github.com/nodejs/single-executable)
- [A helpful blog post on the subject](https://notes.billmill.org/programming/javascript/Making_a_single-file_executable_with_node_and_esbuild.html)

## How To Use This Action

To use this action, you'll need to create a GitHub Workflow that does the
following:

1. Checkout your code
1. Use `actions/setup-node` to install the required Node.js version (which will
   be packaged with your application)
1. Use a bundler (like `esbuild`, `rollup`, or `ncc`) to create a single
   JavaScript file that includes all of your source code and dependencies
   (examples below)
1. Run this action, passing the file path to your bundled JavaScript file

Example configuration:

```yaml
- name: Checkout
  uses: actions/checkout@v4

- uses: actions/setup-node@v4
  with:
    node-version: 22

- run: npm ci

- name: Bundle test application source
  # This example uses `esbuild`, but you can use any bundler
  # that will include all sources and dependencies
  run:
    npx esbuild your_source_entrypoint.ts --bundle --platform=node
    --outfile=dist/main.cjs

- uses: jasongwartz/node-single-executable-action@v0
  id: build-sea
  with:
    # This must be the same file that was generated by a
    # bundler in the previous step
    bundle: dist/main.cjs
    name: my-binary

- name: Verify binary exectuable
  # You should now be able to execute, upload, or deploy your SEA.
  # The path to the binary is the "binary-path" output of the action.
  run: ${{ steps.build-sea.outputs.binary-path }}
```

You will also be able to download the built binary (uploaded as a
[workflow artifact](https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/storing-and-sharing-data-from-a-workflow))
from the Action execution's `Summary` page.

The path to the binary is also available to subsequent action steps as the
`binary-path` output from the action.

> [!WARNING]  
> Binaries built on macOS runners are not notarized, and therefore will be
> prevented from running after download (you will see an error like "can't be
> opened because Apple cannot check it for malicious software").

## Development

Contributions are very welcome! Please create an issue describing the problem to
be solved before opening a PR.

### Getting Started

1. Install the dependencies: `npm install`
1. Write your code changes
1. Run the tests: `npm test`
1. Check the formatting and linting: `npm run format:check` and `npm run lint`
1. Update the checked-in `dist`: `npm run package`

### Helpful Areas for Contribution

Some particular areas where contributions would be useful include:

- [Asset embedding](https://nodejs.org/api/single-executable-applications.html#assets)
- Windows support
- Test coverage (failure modes and edge cases)

### Publishing a New Release

This project includes a helper script, [`script/release`](./script/release)
designed to streamline the process of tagging and pushing new releases for
GitHub Actions.

GitHub Actions allows users to select a specific version of the action to use,
based on release tags. This script simplifies this process by performing the
following steps:

1. **Retrieving the latest release tag:** The script starts by fetching the most
   recent SemVer release tag of the current branch, by looking at the local data
   available in your repository.
1. **Prompting for a new release tag:** The user is then prompted to enter a new
   release tag. To assist with this, the script displays the tag retrieved in
   the previous step, and validates the format of the inputted tag (vX.X.X). The
   user is also reminded to update the version field in package.json.
1. **Tagging the new release:** The script then tags a new release and syncs the
   separate major tag (e.g. v1, v2) with the new release tag (e.g. v1.0.0,
   v2.1.2). When the user is creating a new major release, the script
   auto-detects this and creates a `releases/v#` branch for the previous major
   version.
1. **Pushing changes to remote:** Finally, the script pushes the necessary
   commits, tags and branches to the remote repository. From here, you will need
   to create a new release in GitHub so users can easily reference the new tags
   in their workflows.
